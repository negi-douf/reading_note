# chapter_8: ALU and program counter

## ALU

ALU (Arithmetic Logic Unit) は加算回路  
データ伝送の中にこれを仕込んでいく

- 半加算器 (Half Adder) : 繰り上がり (キャリー) を出力できる加算器
- 全加算器 (Full Adder) : 繰り上がりの出力だけでなく入力も持つ加算器

今回は 4bit CPUを作る話なので、この FAを 4つ連結させる  
そのうえで、先のレジスタ回路にこれを追加する

加算の命令には `ADD A, Im` や `ADD B, Im` などがあり、入力のレジスタを選ぶ必要がある  
そのため、セレクタの回路も一緒に追加して、どれを加算器の入力として採用するかを選択できるようにする  
他に細かい調整もあるが、基本はこんな感じ

また、フラグの話にも触れている  
キャリーをはじめとしたフラグは、基本的に演算の度に中の値が変わるとのこと

### プログラムカウンタ

実行対象の命令のアドレスを保持するカウンタ  
命令を実行したら保持する値を更新する  
複数の番地にまたがる命令を実行した場合、それに応じて更新の幅も変えなければならない  
また、リセットの機能ももつ

この本ではレジスタDをプログラムカウンタとして利用している  
その出力を ROMに伸ばしてアドレスバスとする  
ROMは Chapter.6で作ったもの

また、命令の中にはジャンプも存在する  
つまり、プログラムカウンタを任意の値で更新できるようにしたい  
ただ、ALUからの線は元々レジスタDにも繋いでいたので問題なし

### I/Oポート

TD4では 4bitの入力と出力をサポートする  

まずは出力から考える  
LEDを点灯・消灯して 1, 0を表現させる  
ここではレジスタCの出力 4本に LEDを繋げた  
演算には使えなくなったが、これで出力ができるようになった

次に、同じレジスタの CMOS信号の 4本の線を入力として活用できる  
それぞれスイッチで H/Lを出せるようにすれば、これで 4bitの入力ポートも完成
